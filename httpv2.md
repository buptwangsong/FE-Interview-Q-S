## HTTP 2.0

日后总结，参考这里
[HTTP/2 对现在的网页访问，有什么大的优化呢？体现在什么地方？](https://www.zhihu.com/question/34074946)
[HTTP/2.0 相比1.0有哪些重大改进？](https://www.zhihu.com/question/34074946)

### 五层协议体系结构

（1）应用层（application layer）

> **任务** 通过应用进程间的交互来完成特定的网络应用。

> **数据单元** 报文
    
（2）传输层（transport layer）

> **任务** 负责向两个主机中进程之间的通信提供通用的数据传输服务。

主要使用两种协议：

* 传输控制协议TCP（Transmission Control Protocal） -- 提供面向连接的，可靠的数据传输服务，其数据传输的单位是报文段

* 用户数据包协议UDP （User Data Protocal） -- 提供无连接的，尽最大努力的数据传输服务，不保证数据传输的可靠性。其数据传输的单位是用户数据报

（3）网络层（network layer）

> **任务** 为分组交换网上的不同主机提供数据传输服务。

> **数据单元** IP数据报

（4）数据链路层（data link layer）

> **任务** 完成链路上的数据传输

> **数据单元** 帧

（5）物理层（physical layer）

> **数据传输单元** 比特


### TCP/IP协议

TCP/IP 是一个四层的体系结构，它包含：应用层/传输层/网际层和网络接口层（用网际层这个名字主要是为了强调，这一层是为了解决不同网络的互联问题）


### HTTP V2.O

1.1 简介

HTTP 2.0的出现，相比于HTTP 1.x大幅度提升了web 性能，在于HTTP 1.1语义完全兼容的基础上，进一步减少了网络延迟。

1.2 目的

解决HTTP 1.x版本存在的问题。

影响一个网络请求的因素有两个：带宽和延迟。今天的网络基础建设已经使得网络带宽得到极大的提升，大多数情况下都是网络延迟在影响响应速度。

HTTP 1.0被抱怨最多的问题就是 ***连接无法复用***和***head of line blocking***这两个问题。要理解这两个问题有一个十分重要的前提：客户端是根据域名来与服务器建立连接的。同一时间针对同一域名的连接有一定的数量限制，超过限制数目的请求将会被阻塞（这也是为什么一些站点会有多个静态资源CDN域名的原因）。

**连接无法复用**会导致每次请求都经历三次握手和慢启动。三次握手在高延迟的场景下影响较大，而慢启动则对文件类请求资源较大的场景影响明显。

> **慢启动** TCP连接会随着时间进行自我调谐，期初会限制连接的最大速度，如果数据传输成功，则会随着时间的推移，提高数据的传输速度，直到达到一个最佳的数据传输速度位置。这种调谐被称为TCP慢启动。

> **head of line blocking**会导致带宽无法被充分利用，以及后续简况请求被阻塞。

>> http 1.0规定，在第一个请求没有收到回复之前，后续从应用层发出的请求只能排队。

web 性能优化的终极目标是减少用户端的延迟。让用户能够尽快的打开前端页面并进行想换交互。对客户端而言，就是发送尽可能少的数据给服务器，从服务器下载尽可能少的数据，尽可能的减少round trips time.

1.3 新的特性

* 多路复用（multiplexing）

> 又称**共享连接**，允许同时通过单一的HTTP连接发起多重的请求-响应消息。

> 可以很容易的实现多流并行，而不用依赖建立多个TCP连接。HTTP2.0把http协议通信的基本单位缩小为一个个帧，这些帧对应着逻辑流中的消息，并行的在同一个TCP连接上双向交换消息。

> 解决了：

>> 线头阻塞问题

>> 将多个请求合并为一个的优化方法不再适用

>> 在同一时间针对同一域名的连接有最大数量限制的问题


* 二进制分帧（binary frame）

> 在应用层和传输层之间增加了一层 binary framing， 在该层中，会将所传输的消息分割成更小的帧，并对他们采用二进制编码。

> 没有改动HTTP 1.x的语义、方法、状态码、URI以及首部字段。只是将HTTP 1.x的首部封装在了 head frame中，响应的request body封装在了 body frame中。

> 解决的问题： HTTP 1.x采用的是明文协议，其格式有三部分组成：start line(或者request line, status line)， header， body。要识别这三部分就要做协议解析。HTTP 1.x的协议解析是基于文本的，基于文本的协议解析存在天然的缺陷，比如：文本的表现形式有多样性，要做到健壮性考虑的场景必然很多。

> 多路复用技术的实现，依赖 binary framing所分割得到的帧中的steam id字段。一个request 对应一个stream并分配一个id,这样一个连接上可以有多个stream,每个stream的frame可以随机的混杂在一起传输，接受方可以根据stream id 将frame 再归属到各自不同request 里面。

* 服务器推送（server push）

> 是一种客户端请求之前主动发送数据的机制。HTTP2.0允许对客户端的一个请求发送多个响应。

* 头部压缩 （header compression）




















